---
import styles from './FavoritesList.module.css';
---

<div class={styles.favoritesList} data-favorites-list>
  <p class={styles.emptyState} data-empty-state>
    No favorites yet. Click the star icon on any page to add it to your favorites.
  </p>
  <div data-favorites-container></div>
</div>

<script>
  import { getFavoritesByCategory } from '../../utils/favorites';

  function renderFavorites() {
    const container = document.querySelector('[data-favorites-container]');
    const emptyState = document.querySelector('[data-empty-state]');
    
    if (!container || !emptyState) return;

    const favoritesByCategory = getFavoritesByCategory();
    const categories = Object.keys(favoritesByCategory).sort();

    if (categories.length === 0) {
      emptyState.style.display = 'block';
      container.innerHTML = '';
      return;
    }

    emptyState.style.display = 'none';

    const html = categories.map(category => {
      const favorites = favoritesByCategory[category];
      const items = favorites.map(fav => `
        <li class="FavoritesListItem">
          <a href="${fav.url}">
            ${fav.title}
          </a>
        </li>
      `).join('');

      return `
        <div class="FavoritesList_module_category__">
          <h2 class="FavoritesList_module_categoryTitle__">${category.replace(/-/g, " ").replace(" and ", " & ")}</h2>
          <ul class="FavoritesList_module_favoriteItems__">
            ${items}
          </ul>
        </div>
      `;
    }).join('');

    container.innerHTML = html;
  }

  // Initial render
  renderFavorites();

  // Listen for favorites changes
  window.addEventListener('favoritesChanged', renderFavorites);
  window.addEventListener('storage', (e) => {
    if (e.key === 'notes-favorites') {
      renderFavorites();
    }
  });

  // Re-render on page load (for Astro view transitions)
  document.addEventListener('astro:page-load', renderFavorites);
</script>
